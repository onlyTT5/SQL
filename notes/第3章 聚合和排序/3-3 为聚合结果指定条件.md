# 3-3 为聚合结果指定条件

[toc]

## `HAVING` 子句

如何才能取出“聚合结果正好为 2 行的组”呢

![img](D:/GitRep/SQL/notes/%E7%AC%AC3%E7%AB%A0%20%E8%81%9A%E5%90%88%E5%92%8C%E6%8E%92%E5%BA%8F/3-3%20%E4%B8%BA%E8%81%9A%E5%90%88%E7%BB%93%E6%9E%9C%E6%8C%87%E5%AE%9A%E6%9D%A1%E4%BB%B6.assets/Image00072-16605685152293.gif)

说到指定条件，估计大家都会首先想到 `WHERE` 子句。但是，`WHERE` 子句只能指定记录（行）的条件，而不能用来指定组的条件（例如，“数据行数为 2 行”或者“平均值为 500”等）。

**语法 3-3　`HAVING` 子句**

```sql
SELECT <列名1>, <列名2>, <列名3>, ……
  FROM <表名>
 GROUP BY <列名1>, <列名2>, <列名3>, ……
HAVING <分组结果对应的条件>
```

```sql
SELECT` → `FROM` → `WHERE` → `GROUP BY` → `HAVING
```

**代码清单 3-20　从按照商品种类进行分组后的结果中，取出“包含的数据行数为2行”的组**

```sql
SELECT product_type, COUNT(*)
  FROM Product
 GROUP BY product_type
HAVING COUNT(*) = 2;
```

“销售单价的平均值大于等于 2500 日元”

**代码清单 3-23　使用 `HAVING` 子句设定条件的情况**

```sql
SELECT product_type, AVG(sale_price)
  FROM Product
 GROUP BY product_type
HAVING AVG(sale_price) >= 2500;
```

## `HAVING` 子句的构成要素

- 常数
- 聚合函数
- `GROUP BY` 子句中指定的列名（即聚合键）

## 相对于 `HAVING` 子句，更适合写在 `WHERE` 子句中的条件

有些条件既可以写在 `HAVING` 子句当中，又可以写在 `WHERE` 子句当中。这些条件就是**聚合键所对应的条件** 。

**代码清单 3-25　将条件书写在 `HAVING` 子句中的情况**

```SQL
SELECT product_type, COUNT(*)
FROM Product
GROUP BY product_type
HAVING product_type = '衣服';
```

**代码清单 3-26　将条件书写在 `WHERE` 子句中的情况**

```sql
SELECT product_type, COUNT(*)
FROM Product
WHERE product_type = '衣服'
GROUP BY product_type;
```

**`WHERE` 子句 = 指定行所对应的条件**

**`HAVING` 子句 = 指定组所对应的条件**

