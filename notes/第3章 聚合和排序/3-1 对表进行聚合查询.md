# 3-1 对表进行聚合查询

[toc]

## 聚合函数

通过 SQL 对数据进行某种操作或计算时需要使用**函数** 。

- `COUNT` ：计算表中的记录数（行数）
- `SUM` ：计算表中数值列中数据的合计值
- `AVG` ：计算表中数值列中数据的平均值
- `MAX` ：求出表中任意列中数据的最大值
- `MIN` ：求出表中任意列中数据的最小值

## 计算表中数据的行数

**代码清单 3-1　计算全部数据的行数**

```sql
SELECT COUNT(*)
	FROM Product;
```

## 计算 `NULL` 之外的数据的行数

**代码清单 3-2　计算 `NULL` 之外的数据行数**

```sql
SELECT COUNT(purchase_price)
  FROM Product;
```

**图3-3　只包含 `NULL` 的表**

![{%}](D:/GitRep/SQL/notes/%E7%AC%AC3%E7%AB%A0%20%E8%81%9A%E5%90%88%E5%92%8C%E6%8E%92%E5%BA%8F/3-1%20%E5%AF%B9%E8%A1%A8%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2.assets/Image00053.gif)

**代码清单 3-3　将包含 `NULL` 的列作为参数时，`COUNT(\*)`和`COUNT(<列名>)` 的结果并不相同**

```sql
SELECT COUNT(*), COUNT(col_1)
  FROM NullTbl;
```

**执行结果**

```sql
count | count
------+------
     3|     0
```

> `COUNT` 函数的结果根据参数的不同而不同。`COUNT(*)` 会得到包含`NULL` 的数据行数，而`COUNT(<列名>)` 会得到`NULL`之外的数据行数。

## 计算合计值

==**在这些函数中不能使用星号作为参数。**==

**代码清单 3-4　计算销售单价的合计值**

```sql
SELECT SUM(sale_price)
  FROM Product;
```

![img](D:/GitRep/SQL/notes/%E7%AC%AC3%E7%AB%A0%20%E8%81%9A%E5%90%88%E5%92%8C%E6%8E%92%E5%BA%8F/3-1%20%E5%AF%B9%E8%A1%A8%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2.assets/Image00055-16604659702217.gif)

**代码清单 3-5　计算销售单价和进货单价的合计值**

```sql
SELECT SUM(sale_price), SUM(purchase_price)
  FROM Product;
```

![img](D:/GitRep/SQL/notes/%E7%AC%AC3%E7%AB%A0%20%E8%81%9A%E5%90%88%E5%92%8C%E6%8E%92%E5%BA%8F/3-1%20%E5%AF%B9%E8%A1%A8%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2.assets/Image00057-166046598720512.gif)

> 从结果上说，所有的聚合函数，如果以列名为参数，那么在计算之前就已经把 `NULL` 排除在外了。

## 计算平均值

**代码清单 3-6　计算销售单价的平均值**

```sql
SELECT AVG(sale_price)
  FROM Product;
```

**代码清单 3-7　计算销售单价和进货单价的平均值**

```sql
SELECT AVG(sale_price), AVG(purchase_price)
  FROM Product;
```

## 计算最大值和最小值

**代码清单 3-8　计算销售单价的最大值和进货单价的最小值**

```sql
SELECT MAX(sale_price), MIN(purchase_price)
  FROM Product;
```

`MAX/MIN` 函数和 `SUM/AVG` 函数有一点不同，那就是 `SUM/AVG` 函数只能对数值类型的列使用，而 `MAX/MIN` 函数原则上可以适用于任何数据类型的列。例如：日期。

**代码清单 3-9　计算登记日期的最大值和最小值**

```sql
SELECT MAX(regist_date), MIN(regist_date)
  FROM Product;
```

> `MAX/MIN` 函数几乎适用于所有数据类型的列。`SUM/AVG` 函数只适用于数值类型的列。

## 使用聚合函数删除重复值（关键字 `DISTINCT` ）

**代码清单 3-10　计算去除重复数据后的数据行数**

```sql
SELECT COUNT(DISTINCT product_type)
  FROM Product;
```

**代码清单 3-12　使不使用`DISTINCT` 时的动作差异（`SUM` 函数）**

```sql
SELECT SUM(sale_price), SUM(DISTINCT sale_price)
  FROM Product;
```

> 不仅限于 `COUNT` 函数，所有的聚合函数都可以使用 `DISTINCT` 。
>
> 在聚合函数的参数中使用`DISTINCT` ，可以删除重复数据。