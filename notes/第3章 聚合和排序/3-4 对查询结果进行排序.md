# 3-4 对查询结果进行排序

[toc]

## `ORDER BY` 子句

**代码清单 3-27　显示商品编号、商品名称、销售单价和进货单价的 `SELECT` 语句**

```sql
SELECT product_id, product_name, sale_price, purchase_price
FROM Product;
```

**语法 3-4　`ORDER BY` 子句**

```sql
SELECT <列名1>, <列名2>, <列名3>, ……
  FROM <表名>
  ORDER BY <排序基准列1>, <排序基准列2>, ……
```

**代码清单 3-28　按照销售单价由低到高（升序）进行排列**

```sql
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY sale_price;
```

1. `SELECT` 子句 → 2. `FROM` 子句 → 3. `WHERE` 子句 → 4. `GROUP BY` 子句 → 5. `HAVING` 子句 → 6. `ORDER BY` 子句

## 指定升序或降序

**代码清单 3-29　按照销售单价由高到低（降序）进行排列**

```SQL
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY sale_price DESC;
```

## 指定多个排序键

**代码清单 3-30　按照销售单价和商品编号的升序进行排序**

```sql
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY sale_price, product_id;
```

## `NULL` 的顺序

**代码清单 3-31　按照进货单价的升序进行排列**

```sql
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY purchase_price;
```

## 在排序键中使用显示用的别名

**代码清单 3-32　`ORDER BY` 子句中可以使用列的别名**

```
SELECT product_id AS id, product_name, sale_price AS sp, purchase_price
  FROM Product
ORDER BY sp, id;
```

## `ORDER BY` 子句中可以使用的列

**代码清单 3-33　`SELECT` 子句中未包含的列也可以在 `ORDER BY` 子句中使用**

```sql
SELECT product_name, sale_price, purchase_price
  FROM Product
ORDER BY product_id;
```

**代码清单 3-34　`ORDER BY` 子句中也可以使用聚合函数**

```sql
SELECT product_type, COUNT(*)
FROM Product
GROUP BY product_type
ORDER BY COUNT(*);
```

## 不要使用列编号

**代码清单 3-35　`ORDER BY` 子句中可以使用列的编号**

```SQL
-- 通过列名指定
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY sale_price DESC, product_id;

-- 通过列编号指定
SELECT product_id, product_name, sale_price, purchase_price
  FROM Product
ORDER BY 3 DESC, 1;
```

虽然列编号使用起来非常方便，但我们并不推荐使用，原因有以下两点。

1. **代码阅读起来比较难** 。使用列编号时，如果只看 `ORDER BY` 子句是无法知道当前是按照哪一列进行排序的，只能去 `SELECT` 子句的列表中按照列编号进行确认。上述示例中 `SELECT` 子句的列数比较少，因此可能并没有什么明显的感觉。但是在实际应用中往往会出现列数很多的情况，而且 `SELECT` 子句和 `ORDER BY` 子句之间，还可能包含很复杂的 `WHERE` 子句和 `HAVING` 子句，直接人工确认实在太麻烦了。
2. 这也是最根本的问题，实际上，在 SQL-929 中已经明确指出**该排序功能将来会被删除** 。因此，虽然现在使用起来没有问题，但是将来随着 DBMS 的版本升级，可能原本能够正常执行的 SQL 突然就会出错。不光是这种单独使用的 SQL 语句，对于那些在系统中混合使用的 SQL 来说，更要极力避免。

> 在`ORDER BY` 子句中不要使用列编号。